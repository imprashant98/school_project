{% extends 'school_app/base.html' %} {% block title %}Dashboard - Dechentsemo
Central School{% endblock %} {% block content %}
<section class="dashboard mt-5 mb-5">
  <div class="container">
    <div class="row">
      <h2 class="text-center">School Dashboard</h2>
    </div>

    <!-- Pie Chart for Students -->
    <div class="row mt-5">
      <div class="col-md-6">
        <h3 class="text-center">Total Students</h3>
        <canvas id="studentsPieChart"></canvas>
      </div>

      <div class="col-md-6">
        <h3 class="text-center">Total Teachers</h3>
        <canvas id="teachersPieChart"></canvas>
      </div>
    </div>

    <!-- Calendar -->
    <div class="row mt-5">
      <h3 class="text-center">Upcoming Events</h3>
      {% for event in events %}
      <div class="col-md-4 mb-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ event.title }}</h5>
            <p class="card-text">{{ event.description }}</p>
            <p class="card-text">
              <small class="text-muted">
                Start: {{ event.start_time }} <br />
                End: {{ event.end_time }}
              </small>
            </p>
            <a href="{% url 'view_event' event.id %}" class="btn btn-info"
              >View Details</a
            >
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="text-center mt-4">
      <a href="{% url 'add_event' %}" class="btn btn-primary">Add Event</a>
    </div>

    <!-- Todo List -->
    <div class="row mt-5">
      <div class="col-md-8 offset-md-2">
        <h3 class="text-center">Todo List</h3>
        <ul class="list-group">
          {% for todo in todos %}
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            {{ todo.task }}
            <span>
              {% if todo.completed %}
              <span class="badge bg-success">Completed</span>
              {% else %}
              <a
                href="{% url 'mark_completed' todo.id %}"
                class="btn btn-warning btn-sm"
                >Mark as Completed</a
              >
              {% endif %}
              <a
                href="{% url 'delete_todo' todo.id %}"
                class="btn btn-danger btn-sm"
                >Delete</a
              >
            </span>
          </li>
          {% endfor %}
        </ul>
        <div class="text-center mt-4">
          <a href="{% url 'add_todo' %}" class="btn btn-primary">Add Todo</a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Data from the view
  const studentsData = JSON.parse("{{ students_data | safe }}");
  const teachersData = JSON.parse("{{ teachers_data | safe }}");

  // Students Pie Chart
  const studentsCtx = document
    .getElementById("studentsPieChart")
    .getContext("2d");
  const studentsPieChart = new Chart(studentsCtx, {
    type: "pie",
    data: {
      labels: ["Boys", "Girls"],
      datasets: [
        {
          data: [studentsData.boys, studentsData.girls],
          backgroundColor: ["#36A2EB", "#FF6384"],
          hoverBackgroundColor: ["#36A2EB", "#FF6384"],
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: "bottom",
        },
      },
    },
  });

  // Teachers Pie Chart
  const teachersCtx = document
    .getElementById("teachersPieChart")
    .getContext("2d");
  const teachersPieChart = new Chart(teachersCtx, {
    type: "pie",
    data: {
      labels: ["Teachers"],
      datasets: [
        {
          data: [teachersData.total],
          backgroundColor: ["#FFCE56"],
          hoverBackgroundColor: ["#FFCE56"],
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: "bottom",
        },
      },
    },
  });
</script>
{% endblock %}
